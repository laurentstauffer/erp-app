<div class="project-detail-page">
  <div class="header">
    <h2>{{ isEditMode ? 'Modifier le projet' : 'Nouveau projet' }}</h2>
    <button class="btn-secondary" (click)="cancel()">
      ‚Üê Retour √† la liste
    </button>
  </div>

  <div class="error-message" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <div class="content" *ngIf="!isLoading">
    <div class="section">
      <h3>Informations du projet</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="name">Nom du projet *</label>
          <input 
            id="name" 
            type="text" 
            [(ngModel)]="project.name" 
            placeholder="Entrez le nom du projet"
            required>
        </div>

        <div class="form-group full-width">
          <label for="description">Description *</label>
          <textarea 
            id="description" 
            [(ngModel)]="project.description" 
            placeholder="Entrez la description du projet"
            rows="3"
            required></textarea>
        </div>

        <div class="form-group">
          <label for="startDate">Date de d√©but *</label>
          <input 
            id="startDate" 
            type="date" 
            [(ngModel)]="project.startDate" 
            required>
        </div>

        <div class="form-group">
          <label for="endDate">Date de fin *</label>
          <input 
            id="endDate" 
            type="date" 
            [(ngModel)]="project.endDate" 
            required>
        </div>
      </div>
    </div>

    <div class="section">
      <h3>T√¢ches du projet</h3>
      
      <div class="task-form">
        <h4>{{ editingTaskIndex !== null ? 'Modifier la t√¢che' : 'Ajouter une t√¢che' }}</h4>
        <div class="form-grid">
          <div class="form-group">
            <label for="taskName">Nom de la t√¢che</label>
            <input 
              id="taskName" 
              type="text" 
              [(ngModel)]="newTask.name" 
              placeholder="Nom de la t√¢che">
          </div>

          <div class="form-group">
            <label for="taskDuration">Dur√©e (jours)</label>
            <input 
              id="taskDuration" 
              type="number" 
              [(ngModel)]="newTask.duration" 
              min="1">
          </div>

          <div class="form-group">
            <label for="taskStatus">Statut</label>
            <select id="taskStatus" [(ngModel)]="newTask.status">
              <option value="TODO">√Ä faire</option>
              <option value="IN_PROGRESS">En cours</option>
              <option value="BLOCKED">Bloqu√©e</option>
              <option value="COMPLETED">Termin√©e</option>
            </select>
          </div>

          <div class="form-group">
            <label for="taskPredecessors">D√©pendances (t√¢ches pr√©d√©cesseurs)</label>
            <select 
              id="taskPredecessors" 
              [(ngModel)]="newTask.predecessorIds" 
              multiple
              size="3">
              <option *ngFor="let task of getAvailablePredecessors()" [value]="task.id">
                {{ task.name }}
              </option>
            </select>
            <small class="help-text">Maintenez Ctrl (Cmd sur Mac) pour s√©lectionner plusieurs t√¢ches</small>
          </div>

          <div class="form-group">
            <label for="taskStartDate">Date de d√©but (auto-calcul√©e)</label>
            <input 
              id="taskStartDate" 
              type="date" 
              [(ngModel)]="newTask.startDate"
              readonly
              placeholder="Calcul√©e automatiquement">
          </div>

          <div class="form-group">
            <label for="taskDueDate">Date d'√©ch√©ance (auto-calcul√©e)</label>
            <input 
              id="taskDueDate" 
              type="date" 
              [(ngModel)]="newTask.dueDate"
              readonly
              placeholder="Calcul√©e automatiquement">
          </div>
        </div>
        <div class="task-form-actions">
          <button class="btn-add" (click)="addTask()">
            {{ editingTaskIndex !== null ? 'Mettre √† jour' : '+ Ajouter la t√¢che' }}
          </button>
          <button class="btn-cancel" *ngIf="editingTaskIndex !== null" (click)="cancelEdit()">
            Annuler
          </button>
        </div>
      </div>

      <div class="tasks-list" *ngIf="project.tasks && project.tasks.length > 0">
        <h4>T√¢ches ajout√©es ({{ project.tasks.length }})</h4>
        <div class="recalculate-section">
          <button class="btn-recalculate" (click)="recalculateDates()" *ngIf="isEditMode">
            üîÑ Recalculer les dates
          </button>
        </div>
        <table class="tasks-table">
          <thead>
            <tr>
              <th>Nom</th>
              <th>Dur√©e</th>
              <th>D√©but</th>
              <th>√âch√©ance</th>
              <th>Statut</th>
              <th>D√©pendances</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let task of project.tasks; let i = index">
              <td>{{ task.name }}</td>
              <td>{{ task.duration }} jour{{ task.duration > 1 ? 's' : '' }}</td>
              <td>{{ task.startDate ? (task.startDate | date:'dd/MM/yyyy') : '-' }}</td>
              <td>{{ task.dueDate ? (task.dueDate | date:'dd/MM/yyyy') : '-' }}</td>
              <td>
                <span class="status-badge" [class]="getStatusClass(task.status || 'TODO')">
                  {{ getStatusLabel(task.status || 'TODO') }}
                </span>
              </td>
              <td>
                <span class="dependencies" *ngIf="task.predecessorIds && task.predecessorIds.length > 0">
                  {{ getPredecessorNames(task.predecessorIds).join(', ') }}
                </span>
                <span class="no-dependencies" *ngIf="!task.predecessorIds || task.predecessorIds.length === 0">
                  Aucune
                </span>
              </td>
              <td class="task-actions">
                <button class="btn-edit-small" (click)="editTask(i)" title="Modifier">
                  ‚úèÔ∏è
                </button>
                <button class="btn-delete-small" (click)="removeTask(i)" title="Supprimer">
                  üóëÔ∏è
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <p class="no-tasks" *ngIf="!project.tasks || project.tasks.length === 0">
        Aucune t√¢che ajout√©e pour le moment
      </p>
    </div>

    <div class="actions-footer">
      <button class="btn-secondary" (click)="cancel()">Annuler</button>
      <button class="btn-primary" (click)="saveProject()" [disabled]="isLoading">
        {{ isEditMode ? 'Mettre √† jour' : 'Cr√©er' }}
      </button>
    </div>
  </div>

  <div class="loading" *ngIf="isLoading">
    Chargement...
  </div>
</div>
